name: Postman

# TODO: Limit this to tags (?)
on: push

env:
  # TODO: Modify before merge
  COLLECTION_NAME: ${{ github.run_id }}
  POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
  # TODO: Modify before merge
  WORKSPACE_ID: "5ba71e46-c8ee-4633-84df-7dbd853f5462"

jobs:
  postman:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install openapi-to-postmanv2 (v4) + postman-combine-collections
        run: npm i -g openapi-to-postmanv2@4 postman-combine-collections
      - name: Sync with Postman
        run: ./sync-with-postman.sh
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        # Always upload artifacts, even on failed runs
        if: always()
        with:
          name: postman-collections
          path: postman/
          retention-days: 7
